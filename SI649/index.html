<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>SI 649 Final Project - Narendra Modi</title>
<style>



.axis path,
.axis line, 
.axis1 path,
.axis1 line {
  fill: none;
  stroke: #E6E7E8;
  shape-rendering: crispEdges;
}

.x.axis path, .x.axis1 path {
  display: none;
}

.line {
  fill: none;
  stroke-width: 1.5px;
}

.legend-box {
  cursor: pointer;  
}

#mouse-tracker {
  stroke: #E6E7E8;
  stroke-width: 1px;
}

.hover-line { 
  stroke: #555;
  fill: none;
  stroke-width: 1px;
  left: 10px;
  shape-rendering: crispEdges;
  opacity: 1.0;
}

.hover-text {
  stroke: none;
  font-size: 30px;
  font-weight: bold;
  fill: #000000;
}

.tooltip {
  font-weight: normal;
}

.brush .extent {
  stroke: #FFF;
  shape-rendering: crispEdges;
}

svg {
    padding-top: 5%;
}

</style>
<link href="style.css" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Marcellus" rel="stylesheet" type="text/css">

<body>


  <ul id="nav">
    <li><a href="#intro" title="Next Section"><img src="images/orange_circle.png" alt="Link" id="intro_nav"/></a></li>
      <li><a href="#second" title="Next Section"><img src="images/circle_nav.png" alt="Link" id="second_nav" /></a></li>
      <li><a href="#third" title="Next Section"><img src="images/circle_nav.png" alt="Link" id="third_nav" /></a></li>
      <li><a href="#fifth" title="Next Section"><img src="images/circle_nav.png" alt="Link"
      id="fourth_nav" /></a></li>
    </ul>
  
  <div id="intro">
    <div class="story_intro">
        <div class="float-left">
      <h1>An Analysis of Narendra Modi's Twitter Activity</h1>
      <h3>Lavanya Kumar, Mayank Khanna, Melissa Wu, Naomi Hernandez, Pritika Dasgupta</h3>
          <p>Prime Minister Narendra Modi governs India with a shrewd mind and a generous heart.  He began his work in the sixties when he devoted himself to his nation and fought for democracy in the state of Gujarat. While leading his political party, the Bharatiya Janata Party (BJP), to success in the Gujarat General Assembly, he also managed to maintain his position as Chief Minister of Gujarat. The Chief Minister's efforts culminated to his eventual success as Prime Minister of India. Like many world leaders, he is loved by his people, and Modi's political journey seems far from unordinary. So, what sets him apart from his predecessors?</p>
          </div>
      </div> <!--.story-->
  </div> <!--#intro-->
  
  <div id="second">
    <div class="story_second"><!-- <div class="bg"></div> -->
        <div class="second_story">
              <h1 id="second_h1">Modi's Twitter Expertise</h1>
              <p id="second_p">Narendra Modi's interest in technology and his role as Prime Minister during one of the greatest eras of technological advancement explains his innovative approach as a leader. Modi strongly believes in the power of technology for impact and highly advocates for the use of social media, specifically Twitter. Our visualization analyzes the Prime Minister's Twitter activity since his adoption of the platform in 2009.</p>
              <iframe width="720" height="425" src="https://www.youtube.com/embed/AMBufMvMXR4" frameborder="0" allowfullscreen></iframe>
          </div>
      </div> <!--.story-->
      
  </div> <!--#second-->
  
  <div id="third">
    <div class="story_third">
        <div class="float-left">
            <h1>The Phases of Modi's Political Career</h1>
              <p style="width:700px;">Have a table that talks about this various phases and includes the time frames and definitions of each phase. To clearly understand the time-based breakdown of Modi's career, we divided his time on Twitter into six political phases. Each of the phases are of various lengths and highlight different and significant positions that Modi has held in office.   </p>
			<img src="images/static_timeline.png" style=" width: 700px; margin-left: 140px; margin-top: 40px;" />
			<p style="float:left; margin-left:95px;margin-top:20px; width:700px; font-size:14px;">This yearly timeline depicts each phase of Modi's early political career before his first tweet (encoded by yellow/orange palette) and Modi's political career after his first tweet (encoded by the blue palette). There are six phases total, which are strategically split up to show how his political career and campaigning evolves. Additionally, a scatter plot showing the number of tweets/day from February 2009 to October 2015 is shown in orange.
			</p>
          </div>
      </div> <!--.story-->
  </div> <!--#third-->
  
  <div id="fifth">
    <h1>Virality, Message Type, and Themes of Tweets from 2009-2015</h1>
    <div class="story_viz">
    <!-- where the visualizations go -->   
    </div> <!--.story-->
  </div> <!--#fifth-->
</body>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="scripts/jquery.parallax-1.1.3.js"></script>
<script type="text/javascript" src="scripts/jquery.localscroll-1.2.7-min.js"></script>
<script type="text/javascript" src="scripts/jquery.scrollTo-1.4.2-min.js"></script>

<!--LAVANYA'S JS -->
<script type="text/javascript">
$(document).ready(function(){

	$('#nav').localScroll(800); //static unordered nav list on the right hand side 
	
	//.parallax(xPosition, speedFactor, outerHeight) options:
	//xPosition - Horizontal position of the element
	//inertia - speed to move relative to vertical scroll. Example: 0.1 is one tenth the speed of scrolling, 2 is twice the speed of scrolling
	//outerHeight (true/false) - Whether or not jQuery should use it's outerHeight option to determine when a section is in the viewport
	$('#intro').parallax("90%", 0.1);
	$('#second').parallax("50%", 0.1);
	// $('.bg').parallax("50%", 0.4);
	$('#third').parallax("50%", 0.3);

});

</script>

<script>
window.onscroll = function() {myFunction1(), myFunction2(), myFunction3()};

function myFunction1() {
    if (document.body.scrollTop < 700) {
        document.getElementById("intro_nav").src = "images/orange_circle.png";
        document.getElementById("second_nav").src = "images/circle_nav.png";
        document.getElementById("third_nav").src = "images/circle_nav.png";
        document.getElementById("fourth_nav").src = "images/circle_nav.png";

    } 
    else if (document.body.scrollTop >= 700 || document.documentElement.scrollTop >= 700) {
        document.getElementById("second_nav").src = "images/orange_circle.png";
        document.getElementById("intro_nav").src = "images/circle_nav.png";
        document.getElementById("third_nav").src = "images/circle_nav.png";
        document.getElementById("fourth_nav").src = "images/circle_nav.png";
    }
}

function myFunction2() {
    if (document.body.scrollTop >= 1300 || document.documentElement.scrollTop >= 1300 ) {
    	document.getElementById("third_nav").src = "images/orange_circle.png";
        document.getElementById("second_nav").src = "images/circle_nav.png";
        document.getElementById("intro_nav").src = "images/circle_nav.png";
        document.getElementById("fourth_nav").src = "images/circle_nav.png";
    }
}

function myFunction3() {
    if (document.body.scrollTop >= 2000 || document.documentElement.scrollTop >= 2000 ) {
    	document.getElementById("fourth_nav").src = "images/orange_circle.png";
        document.getElementById("second_nav").src = "images/circle_nav.png";
        document.getElementById("intro_nav").src = "images/circle_nav.png";
        document.getElementById("third_nav").src = "images/circle_nav.png";
    }
   
}
</script>

<!-- End of Lavanya's JS -->

<script src="http://d3js.org/d3.v3.js"></script>





<!-- MELISSA'S JS -->
<script>

var margin = {top: 20, right: 300, bottom: 100, left: 50},
    margin2 = { top: 430, right: 10, bottom: 40, left: 40 },
    width = 820 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom,
    height2 = 500 - margin2.top - margin2.bottom;

var parseDate = d3.time.format("%Y%m%d").parse;
var bisectDate = d3.bisector(function(d) { return d.date; }).left;

var phasecategories = [{"key":"Phase 1"},{"key":"Phase 2"},{"key":"Phase 3"},{"key":"Phase 4"},{"key":"Phase 5"},{"key":"Phase 6"},];

var xScale = d3.time.scale()
    .range([0, width]),

    xScale2 = d3.time.scale()
    .range([0, width]); // Duplicate xScale for brushing ref later

    xScale3 = d3.scale.ordinal()
    .domain(phasecategories.map(function (d) {return d.key; })) //scale to mark out phases underneath the brushing box
    .rangeRoundBands([margin2.left-80, width], 0.05);

var yScale = d3.scale.linear()
    .range([height, 0]);

// 40 Custom DDV colors 
var color = d3.scale.ordinal().range(["#151E5E", "#FBDB68", "#E3CF6D", "#80CEAA", "#80CCB3", "#7FC9BD", "#7FC7C6", "#7EC4CF", "#7FBBCF", "#7FB1CF", "#80A8CE", "#809ECE", "#8897CE", "#8F90CD", "#9788CD", "#9E81CC", "#AA81C5", "#B681BE", "#C280B7", "#CE80B0", "#D3779F", "#D76D8F", "#DC647E", "#E05A6D", "#E16167", "#E26962", "#E2705C", "#E37756", "#E39158", "#E29D58", "#E2AA59", "#E0B15B", "#DFB95C", "#DDC05E", "#DBC75F", "#EAD67C", "#F2DE8A","#48A36D",  "#56AE7C",  "#64B98C"]);  

var color2 = d3.scale.ordinal().range(["#151E5E", "#FBDB68", "#E3CF6D"]);  
var color3 = d3.scale.ordinal().range(["#151E5E", "#FBDB68", "#E3CF6D"]);  
var color4 = d3.scale.ordinal().range(["#151E5E", "#FBDB68", "#E3CF6D"]);

var xAxis = d3.svg.axis()
    .scale(xScale)
    .orient("bottom"),

    xAxis2 = d3.svg.axis() // xAxis for brush slider
    .scale(xScale2)
    .orient("bottom");  

    xAxis3 = d3.svg.axis() // xAxis for phases
    .scale(xScale3)
    .orient("bottom");  

var yAxis = d3.svg.axis()
    .scale(yScale)
    .orient("left");  

var line = d3.svg.line()
    .interpolate("cardinal")
    .x(function(d) { return xScale(d.date); })
    .y(function(d) { return yScale(d.rating); })
    .defined(function(d) { return d.rating; });  // Hiding line value defaults of 0 for missing data

var maxY; // Defined later to update yAxis

var svg = d3.select(".story_viz").append("svg").attr("class","timeline").attr("style","float:left; margin-left:50px; margin-top:-50px;")
    .attr("width", width + margin.left + margin.right+100)
    .attr("height", 800); //height + margin.top + margin.bottom

  svg.append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

// Create invisible rect for mouse tracking
svg.append("rect")
    .attr("width", width)
    .attr("height", height)                                    
    .attr("x", 0) 
    .attr("y", 0)
    .attr("id", "mouse-tracker")
    .style("fill", "white"); 

//for slider part-----------------------------------------------------------------------------------
  
var context = svg.append("g") // Brushing context box container
    .attr("transform", "translate(" + 0 + "," + 410 + ")")
    .attr("class", "context");

//for phases timline
var phases = svg.append("g") // Brushing context box container
    .attr("transform", "translate(" + 0 + "," + 440 + ")")
    .attr("class", "phases");

//append clip path for lines plotted, hiding those part out of bounds
svg.append("defs")
  .append("clipPath") 
    .attr("id", "clip")
    .append("rect")
    .attr("width", width)
    .attr("height", height); 

//end slider part----------------------------------------------------------------------------------- 

d3.tsv("data1_log.tsv", function(error, data) { 
  color.domain(d3.keys(data[0]).filter(function(key) { // Set the domain of the color ordinal scale to be all the csv headers except "date", matching a color to an issue
  	//console.log(data[0]);
    return (key !== "date" && key !=="Impevents"); 
  }));

  data.forEach(function(d) { // Make every date in the csv data a javascript date object format
    d.date = parseDate(d.date);
  });

  var categories = color.domain().map(function(name) { // Nest the data into an array of objects with new keys

    return {
      name: name, // "name": the csv headers except date
      values: data.map(function(d) { // "values": which has an array of the category's name, if the date has an important event, whether or not the line is visible, the date and the rating(amount of callouts, handles, etc)
        return {
          category: name,
          impevent: d.Impevents,
          visible: true,
          date: d.date, 
          rating: +(d[name]),
          };
      }),
      //visible: (name === "Unemployment" ? true : false) // "visible": all false except for economy which is true.
      visible: true
    };
  });

  xScale.domain(d3.extent(data, function(d) { return d.date; })); // extent = highest and lowest points, domain is data, range is bouding box

  // yScale.domain([0, 280000
  //   //d3.max(categories, function(c) { return d3.max(c.values, function(v) { return v.rating; }); })
  // ]);

  yScale.domain([0, 14
    //d3.max(categories, function(c) { return d3.max(c.values, function(v) { return v.rating; }); })
  ]);

  xScale2.domain(xScale.domain()); // Setting a duplicate xdomain for brushing reference later
 
 //for phases part-----------------------------------------------------------------------------------
 // phases.append("g") // Create brushing xAxis
 //    .attr("class", "x axis1")
 //    .attr("transform", "translate(0," + height2 + ")")
 //    .call(xAxis3);
 
 //for slider part-----------------------------------------------------------------------------------
 var brush = d3.svg.brush()//for slider bar at the bottom
    .x(xScale2) 
    .on("brush", brushed);

  context.append("g") // Create brushing xAxis
      .attr("class", "x axis1")
      .attr("transform", "translate(0," + height2 + ")")
      .call(xAxis2);

  var contextArea = d3.svg.area() // Set attributes for area chart in brushing context graph
    .interpolate("monotone")
    .x(function(d) { return xScale2(d.date); }) // x is scaled to xScale2
    .y0(height2) // Bottom line begins at height2 (area chart not inverted) 
    .y1(0); // Top line of area, 0 (area chart not inverted)

  //plot the rect as the bar at the bottom
  context.append("path") // Path is created using svg.area details
    .attr("class", "area")
    .attr("d", contextArea(categories[0].values)) // pass first categories data .values to area path generator 
    .attr("fill", "#F1F1F2");
    
  //append the brush for the selection of subsection  
  context.append("g")
    .attr("class", "x brush")
    .call(brush)
    .selectAll("rect")
    .attr("height", height2) // Make brush rects same height 
      .attr("fill", "#E6E7E8");  
  //end slider part-----------------------------------------------------------------------------------

  // draw line graph
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 4)
      .attr("x", -150)
      .attr("dy", ".71em")
      .style("text-anchor", "end")
      .style("font", "Proxima Nova Light")
      .text("Log(#)");

  var issue = svg.selectAll(".issue")
      .data(categories) // Select nested data and append to new svg group elements
    .enter().append("g")
      .attr("class", "issue");   

  issue.append("path")
      .attr("class", "line")
      .style("pointer-events", "none") // Stop line interferring with cursor
      .attr("id", function(d) {
        return "line-" + d.name.replace(" ", "").replace("/", ""); // Give line id of line-(insert issue name, with any spaces replaced with no spaces)
      })
      .attr("d", function(d) { 
	    //console.log(d.visible);
        return d.visible ? line(d.values) : null; // If array key "visible" = true then draw line, if not then don't 
      })
      .attr("clip-path", "url(#clip)")//use clip path to make irrelevant part invisible
      .style("stroke", function(d) { return color(d.name); });

  //plotting points on each line (only dates with important events will show up in red)
  issue.selectAll(".point")
    .data(function (d) {  return d.values; })
    .enter().append("circle")
     .attr("class", "point")
     .attr("cx", function (d,i) {  return xScale(d.date); })
     .attr("cy", function (d) { return !isNaN(d.rating) ? yScale(d.rating): yScale(0); })
     .attr("r", "3px")
     .attr("clip-path", "url(#clip)")//use clip path to make irrelevant part invisible
     .style("fill", function (d) { 
        if (d.visible)
        {
          if (d.impevent =="Y") 
            {return "#E45E2D";} 
          // else { return color(d.category);}
          else { return "none";}
        }
        else
        {
            return "none";
        }
      })
     .style("stroke", function (d) { 
        if (d.visible)
        {
          if (d.impevent =="Y") 
            {return "#E45E2D";} 
          // else { return color(d.category);}
          else { return "none";}
        }
        else
        {
            return "none";
        }
      })
     .style("stroke-width", "px");

  // draw legend
  var legendSpace = 150 / categories.length; // 450/number of issues (ex. 40)    

  issue.append("rect")
      .attr("width", 10)
      .attr("height", 10)                                    
      .attr("x", 25) 
      .attr("y", function (d, i) { return 10+i*20; })  // spacing
      .attr("fill",function(d) {
        return d.visible ? color(d.name) : "#F1F1F2"; // If array key "visible" = true then color rect, if not then make it grey 
      })
      .attr("class", "legend-box")

      .on("click", function(d){ // On click make d.visible 
        d.visible = !d.visible; // If array key for this data selection is "visible" = true then make it false, if false then make it true

        for (var j = 0; j < d.values.length; j++){
          d.values[j].visible = !d.values[j].visible;
          //console.log(d.values[j].visible);
        }

        maxY = findMaxY(categories); // Find max Y rating value categories data with "visible"; true
        yScale.domain([0,maxY]); // Redefine yAxis domain based on highest y value of categories data with "visible"; true
        svg.select(".y.axis")
          .transition()
          .call(yAxis);   

        issue.select("path")
          .transition()
          .attr("d", function(d){
            return d.visible ? line(d.values) : null; // If d.visible is true then draw line for this d selection
          })

        issue.select("rect")
          .transition()
          .attr("fill", function(d) {
          return d.visible ? color(d.name) : "#F1F1F2";
        });

        issue.selectAll(".point")
          .style("fill", function(d) {
            if (d.visible)
              {
                if (d.impevent =="Y") 
                  {return "red";} 
                // else { return color(d.category);}
                else { return "none";}
              }
              else
              {
                  return "none";
              }
          })
          .style("stroke", function(d) {
            if (d.visible)
              {
                if (d.impevent =="Y") 
                  {return "red";} 
                // else { return color(d.category);}
                else { return "none";}
              }
              else
              {
                  return "none";
              }
          })
          .transition()
          .attr("cx", function (d,i) {  return xScale(d.date); })
          .attr("cy", function (d) { return !isNaN(d.rating) ? yScale(d.rating): yScale(0); })
          .attr("r", "3px");

      })

      .on("mouseover", function(d){

        d3.select(this)
          .transition()
          .attr("fill", function(d) { return color(d.name); });

        d3.select("#line-" + d.name.replace(" ", "").replace("/", ""))
          .transition()
          .style("stroke-width", 2.5);  
      })

      .on("mouseout", function(d){

        d3.select(this)
          .transition()
          .attr("fill", function(d) {
          return d.visible ? color(d.name) : "#F1F1F2";});

        d3.select("#line-" + d.name.replace(" ", "").replace("/", ""))
          .transition()
          .style("stroke-width", 1.5);
      })
      
  issue.append("text")
      .attr("x", 45) 
      .attr("y", function (d, i) { return 20+i*20; })  // (return (11.25/2 =) 5.625) + i * (5.625) 
      .text(function(d) { return d.name; }); 

  // Hover line 
  var hoverLineGroup = svg.append("g") 
            .attr("class", "hover-line");

  var hoverLine = hoverLineGroup // Create line with basic attributes
        .append("line")
            .attr("id", "hover-line")
            .attr("x1", 10).attr("x2", 10) 
            .attr("y1", 0).attr("y2", height + 10)
            .style("pointer-events", "none") // Stop line interferring with cursor
            .style("opacity", 1e-6); // Set opacity to zero 

  var hoverDate = hoverLineGroup
        .append('text')
            .attr("class", "hover-text")
            .attr("y", height - (height-40)) // hover date text position
            .attr("x", width - 150) // hover date text position
            .style("fill", "#999");


  d3.tsv("data1.tsv", function(error, data1) { 
    color.domain(d3.keys(data1[0]).filter(function(key) { // Set the domain of the color ordinal scale to be all the csv headers except "date", matching a color to an issue
      return (key !== "date" && key !=="Impevents"); 
    }));

    data1.forEach(function(d) { // Make every date in the csv data a javascript date object format
      d.date = parseDate(d.date);
    });

    var categories_1 = color.domain().map(function(name) { // Nest the data into an array of objects with new keys

      return {
        name: name, // "name": the csv headers except date
        values: data1.map(function(d) { // "values": which has an array of the category's name, if the date has an important event, whether or not the line is visible, the date and the rating(amount of callouts, handles, etc)
          return {
            category: name,
            impevent: d.Impevents,
            visible: true,
            date: d.date, 
            rating: +(d[name]),
            };
        }),
        //visible: (name === "Unemployment" ? true : false) // "visible": all false except for economy which is true.
        visible: true
      };
    });

// console.log(categories_1);
  var issue_1 = svg.selectAll(".issue_1")
      .data(categories_1) // Select nested data and append to new svg group elements
    .enter().append("g")
      .attr("class", "issue_1");   


  var columnNames = d3.keys(data[0]) //grab the key values from your first data row
                                     //these are the same as your column names
                  .slice(1,3); //remove the column name (`date`) and column name (`impevent`);

  var columnNames_1 = d3.keys(data1[0]).slice(1,3);



  var focus = issue.select("g") // create group elements to house tooltip text
      .data(columnNames) // bind each column name date to each g element
    .enter().append("g") //create one <g> for each columnName
      .attr("class", "focus"); 

  focus.append("text") // http://stackoverflow.com/questions/22064083/d3-js-multi-series-chart-with-y-value-tracking
        .attr("class", "tooltip")
        .attr("x", width + 170) // position tooltips  
        .attr("y", function (d, i) { return (legendSpace)+i*(legendSpace); }); // (return (11.25/2 =) 5.625) + i * (5.625) // position tooltips       

  var focus_1 = issue_1.select("g") // create group elements to house tooltip text
      .data(columnNames_1) // bind each column name date to each g element
    .enter().append("g") //create one <g> for each columnName
      .attr("class", "focus_1"); 

  focus_1.append("text") // http://stackoverflow.com/questions/22064083/d3-js-multi-series-chart-with-y-value-tracking
        .attr("class", "tooltip_raw")
        .attr("x", 120) // position tooltips  
        .attr("y", function (d, i) { return 20+i*20; }); 

  // Add mouseover events for hover line.
  d3.select("#mouse-tracker") // select chart plot background rect #mouse-tracker
  .on("mousemove", mousemove) // on mousemove activate mousemove function defined below
  .on("mouseout", function() {
      hoverDate
          .text(null) // on mouseout remove text for hover date

      d3.select("#hover-line")
          .style("opacity", 1e-6); // On mouse out making line invisible
  });

  // Add click events for hover line.
  d3.select("#mouse-tracker") // select chart plot background rect #mouse-tracker
  .on("click", mouseclick); // on mousemove activate mousemove function defined below


  function mouseclick () {
      var mouse_x = d3.mouse(this)[0]; // Finding mouse x position on rect
      var graph_x = xScale.invert(mouse_x); //


      var format = d3.time.format("%Y%m%d");
      var format2 = d3.time.format("%b %d %Y");

      var datecompare = format(graph_x);
      //console.log(datecompare);
      

      svg.selectAll(".eventdesc").remove();
      svg.selectAll(".eventdet").remove();
      svg.selectAll(".tweet").remove();
      svg.selectAll(".tweetid").remove();

      d3.tsv("data2.tsv", function(error, data2) { 
        color2.domain(d3.keys(data2[0]).filter(function(key) { 
          return (key !== "date"); 
        }));

        data2.forEach(function(d) { // Make every date in the csv data a javascript date object format
          d.date = parseDate(d.date);
        });

        var tweets = color2.domain().map(function(name) { // Nest the data into an array of objects with new keys

          return {
            name: name, // "name": the csv headers except date
            values: data2.map(function(d) { // "values": which has an array of the dates and tweets
              console.log(datecompare);
              if (datecompare == format(d.date))
              {
                return {
                  date: d.date, 
                  tweets: d.tweets,
                };
              }
            }),
          };
        });
        //console.log(tweets);

        tweetsarray = tweets[0].values;
        //console.log(tweetsarray);

        for (var j = 0; j < tweetsarray.length; j++){
          if (typeof  tweetsarray[j] != "undefined") {
              individualtweet = tweetsarray[j].tweets.split('|');
              individualtweet = individualtweet.slice(1);
              //console.log(individualtweet);
          }
        }

        /*var tweet = svg.selectAll(".tweet")
          .data(individualtweet)
        .enter().append("g")
          .attr("class", "tweet");   

        //console.log(tweet.length);
        var legendSpace2 = 1050 / individualtweet.length;
        
        //Tweet Title
        tweet.append("text")
          // .attr("x", width + (margin.right/2) + 100) 
          .attr("x", 0) 
          .attr("y", 490)
          .text("Date of Tweets: " + format2(graph_x))
          .style("font-weight", "bold"); 

        tweet.append("text")
          .attr("x", width + (margin.right/2) + 100) 
          // .attr("y", function (d, i) { return (legendSpace2)+i*(legendSpace2); })  // (return (11.25/2 =) 5.625) + i * (5.625)
          .attr("y", function (d, i) { return (28+((i*3)+5)); })  // (return (11.25/2 =) 5.625) + i * (5.625)  
          .text(
            function(d, i) { 
               //console.log(i)
              return ("Tweet " + (i+1) + ": " + d.trim()); 
            }
          )
          .call(wrap2, 600); */
      });
      
      d3.tsv("data3.tsv", function(error, data3) { 
        color3.domain(d3.keys(data3[0]).filter(function(key) { 
          return (key !== "date"); 
        }));

        data3.forEach(function(d) { // Make every date in the csv data a javascript date object format
          d.date = parseDate(d.date);
        });

        var events = color3.domain().map(function(name) { // Nest the data into an array of objects with new keys

          return {
            name: name, // "name": the csv headers except date
            values: data3.map(function(d) { // "values": which has an array of the dates and event or event details
             //alert(datecompare.substring(0, 6));
              if (datecompare.substring(0, 6) == format(d.date).substring(0, 6))
              {
                return {
                  date: d.date, 
                  value: d[name], //event or event details values
                };
              }
            }),
          };
        });
        //console.log(events);
      //for event description-----------------------------------------------------------------------------

      //console.log(eventdescriptions);

      var eventdesc = svg.append("g") // Event container
          .attr("transform", "translate(" + 590 + "," + 580 + ")")
          .attr("class", "eventdesc");

      var eventdesc2 = svg.selectAll(".eventdesc")
        .datum(events);

      //EVENT TITLE
      eventdesc2.append("text")
        .attr("transform", "translate(0," + (height2-50) + ")")
            .text(function(d,i) { 
              for (var j = 0; j < events.length; j++){
                if (typeof  events[j] != "undefined") {
                  if (d[j].name == "EventTweet")
                  {
                    var eventsarray = events[j].values;
                    for (var k = 0; k < eventsarray.length; k++){
                      if (typeof  eventsarray[k] != "undefined") {
                        return ("Event Date: " + format2(graph_x))
                      }
                    }
                  }
                }
              }
            })
          .style("font-size", "20px;");

      eventdesc2.append("text") 
            .attr("class", "eventdesctext")
            .attr("transform", "translate(0," + height2-30 + ")")
            .text(function(d,i) { 
              for (var j = 0; j < events.length; j++){
                if (typeof  events[j] != "undefined") {
                  if (d[j].name == "EventTweet")
                  {
                    var eventsarray = events[j].values;
                    for (var k = 0; k < eventsarray.length; k++){
                      // var individualarray = eventsarray[k];
                      // console.log(eventsarray[k]);
                      if (typeof  eventsarray[k] != "undefined") {
                        //console.log(eventsarray[k].value);
                        return ("Tweet: " + eventsarray[k].value);
                      }
                    }
                  }
                }
              }
            })
            .style("fill", "#E45E2D")
            .call(wrap,300);

      var eventdet = svg.append("g") // Event container
          .attr("transform", "translate(" + 30 + "," + 500 + ")")
          .attr("class", "eventdet")

      var eventdet2 = svg.selectAll(".eventdet")
        .datum(events);

      eventdet2.append("text") 
            .attr("class", "eventdettext")
            .attr("transform", "translate(0,0)")
	        .attr("fill","#E45E2D")
            .text(function(d) { 
              for (var j = 0; j < events.length; j++){
                if (typeof  events[j] != "undefined") {
                  if (d[j].name == "Event_Description")
                  {
                    var eventsarray = events[j].values;
                    for (var k = 0; k < eventsarray.length; k++){
                      // var individualarray = eventsarray[k];
                      // console.log(eventsarray[k]);
                      if (typeof  eventsarray[k] != "undefined") {
                        //console.log(eventsarray[k].value);
                        return ("Event Description: " + eventsarray[k].value);
                      }
                    }
                  }
                }
              }
            })
           .call(wrap, 450);

      var tweetid = svg.append("g") // Event container
          .attr("transform", "translate(" + 30 + "," + 500 + ")")
          .attr("class", "tweetid")

      var tweetid2 = svg.selectAll(".tweetid")
        .datum(events);
//var twid;
      tweetid2.append("text") 
            .attr("class", "tweetidtext")
            .attr("transform", "translate(0," + (height2+10) + ")")
            .text(function(d) { 
              for (var j = 0; j < events.length; j++){
                if (typeof  events[j] != "undefined") {
                  if (d[j].name == "Tweet_ID")
                  {
                    var eventsarray = events[j].values;
                    for (var k = 0; k < eventsarray.length; k++){
                      // var individualarray = eventsarray[k];
                      // console.log(eventsarray[k]);
                      if (typeof  eventsarray[k] != "undefined") {
						special_mouseover(eventsarray[k].value);
                        //return ("Tweet ID: " + eventsarray[k].value);
						
                      }
                    }
                  }
                }
              }
            });
      });
	  

  }

  function wrap(text, width) {
    text.each(function() {
      var text = d3.select(this),
          words = text.text().split(/\s+/).reverse(),
          word,
          line = [],
          lineNumber = 0,
          lineHeight = 1.1, // ems
          y = text.attr("y"),
          dy = parseFloat(text.attr("y")),
          tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("y", y + "em");
      while (word = words.pop()) {
        line.push(word);
        tspan.text(line.join(" "));
        if (tspan.node().getComputedTextLength() > width) {
          line.pop();
          tspan.text(line.join(" "));
          line = [word];
          tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("y", ++lineNumber * lineHeight + y + "em").text(word);
        }
      }
    });
  }

  function wrap2(text, width) {
    text.each(function() {
      var text = d3.select(this),
          words = text.text().split(/\s+/).reverse(),
          word,
          line = [],
          lineNumber = 0,
          lineHeight = 1.1, // ems
          y = text.attr("y"),
          dy = parseFloat(text.attr("y")),
          tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("y", y + "em");
      while (word = words.pop()) {
        line.push(word);
        tspan.text(line.join(" "));
        if (tspan.node().getComputedTextLength() > width) {
          line.pop();
          tspan.text(line.join(" "));
          line = [word];
          ++lineNumber;
          var addy = parseInt(y) + lineNumber; //console.log(addy);
          tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("y", addy + "em").text(word);
        }
      }
    });
  }
  function mousemove() { 
      var mouse_x = d3.mouse(this)[0]; // Finding mouse x position on rect
      var graph_x = xScale.invert(mouse_x); // 

      //var mouse_y = d3.mouse(this)[1]; // Finding mouse y position on rect
      //var graph_y = yScale.invert(mouse_y);
      //console.log(graph_x);

      var format = d3.time.format('%b %Y'); // Format hover date text to show three letter month and full year
      var format2 = d3.time.format("%Y%m%d");
      var format3 = d3.time.format("%b %d %Y");

      var datecompare = format2(graph_x);

      //console.log(format2(graph_x));
      //alert(format2(graph_x));

      //alert(format(graph_x));
      
      // show date above the legend -----------------------------------------------------------------------------
      svg.selectAll(".showdate").remove();

      var showdate = issue.select("g") 
        .data(format3(graph_x))
      .enter().append("g") 
        .attr("class", "showdate"); 

    /*  showdate.append("text") 
        .attr("class", "tooltip")
        .attr("x", width + 20) 
        .attr("y", 10)
        .style("font-size", "1.2em");*/

      showdate.select("text").text("Date: " + format3(graph_x));
      
      // end of date legend

      d3.tsv("data4.tsv", function(error, data4) { 
        color4.domain(d3.keys(data4[0]).filter(function(key) { 
          return (key !== "date"); 
        }));

        data4.forEach(function(d) { // Make every date in the csv data a javascript date object format
          d.date = parseDate(d.date);
        });

        var titles = color4.domain().map(function(name) { // Nest the data into an array of objects with new keys

          return {
            name: name, // "name": the csv headers except date
            values: data4.map(function(d) { // "values": which has an array of the dates and tweets
              //console.log(datecompare);
              if (datecompare == format2(d.date))
              {
                return {
                  date: d.date, 
                  title: d.TitleName,
                };
              }
            }),
          };
        });

      //console.log(titles);
      //Chart Title
      svg.selectAll(".showtitle").remove();

      var showtitle = issue.select("g") 
        .data(titles)
      .enter().append("g") 
        .attr("class", "showtitle"); 

      showtitle.append("text") 
        .attr("class", "showtitletext")
        .attr("x", 40) 
        .attr("y", -15)
        .style("font-size", "15px")
        .style("font-weight", "bold")
        .text(function(d,i) { 
            for (var j = 0; j < titles.length; j++){
              if (typeof  titles[j] != "undefined") {
                if (titles[j].name == "TitleName")
                {
                  var titlesarray = titles[j].values;
                  //console.log(titlesarray);
                  for (var k = 0; k < titlesarray.length; k++){
                    if (typeof  titlesarray[k] != "undefined") {
                      // console.log(titlesarray[k].title);
                      return (titlesarray[k].title)
                    }
                  }
                }
              }
            }
          });

      //end of Chart Title


      });

      //Legend title for categories -----------------------------------------------------------------------------

      svg.selectAll(".showlegend").remove();

      var showlegend_log = issue.select("g") 
        .data(format3(graph_x))
      .enter().append("g") 
        .attr("class", "showlegend_log"); 

      showlegend_log.append("text") 
        .attr("class", "tooltip")
        .attr("x", width + 170) 
        .attr("y", 30);

      //showlegend_log.select("text").text("Log(#)");

      var showlegend_raw = issue.select("g") 
        .data(format3(graph_x))
      .enter().append("g") 
        .attr("class", "showlegend_raw"); 

      showlegend_raw.append("text") 
        .attr("class", "tooltip")
        .attr("x", width + 230) 
        .attr("y", 30);

      //showlegend_raw.select("text").text("#");

      // end of legend title
    

      hoverDate.text(format(graph_x)); // scale mouse position to xScale date and format it to show month and year
      
      d3.select("#hover-line") // select hover-line and changing attributes to mouse position
          .attr("x1", mouse_x) 
          .attr("x2", mouse_x)
          .style("opacity", 1); // Making line visible

      // Legend tooltips // http://www.d3noob.org/2014/07/my-favourite-tooltip-method-for-line.html

      var x0 = xScale.invert(d3.mouse(this)[0]), /* d3.mouse(this)[0] returns the x position on the screen of the mouse. xScale.invert function is reversing the process that we use to map the domain (date) to range (position on screen). So it takes the position on the screen and converts it into an equivalent date! */
      i = bisectDate(data, x0, 1), // use our bisectDate function that we declared earlier to find the index of our data array that is close to the mouse cursor
      /*It takes our data array and the date corresponding to the position of or mouse cursor and returns the index number of the data array which has a date that is higher than the cursor position.*/
      d0 = data[i - 1],
      d1 = data[i],
      /*d0 is the combination of date and rating that is in the data array at the index to the left of the cursor and d1 is the combination of date and close that is in the data array at the index to the right of the cursor. In other words we now have two variables that know the value and date above and below the date that corresponds to the position of the cursor.*/
      d = x0 - d0.date > d1.date - x0 ? d1 : d0;
      
      var x0_1 = xScale.invert(d3.mouse(this)[0]),
      i1= bisectDate(data1, x0, 1), 
      d0_1 = data1[i - 1],
      d1_1 = data1[i],
      d1 = x0_1 - d0_1.date > d1_1.date - x0_1 ? d1_1 : d0_1;

      // console.log(d1);

      /*The final line in this segment declares a new array d that is represents the date and close combination that is closest to the cursor. It is using the magic JavaScript short hand for an if statement that is essentially saying if the distance between the mouse cursor and the date and close combination on the left is greater than the distance between the mouse cursor and the date and close combination on the right then d is an array of the date and close on the right of the cursor (d1). Otherwise d is an array of the date and close on the left of the cursor (d0).*/

      //d is now the data row for the date closest to the mouse position


      /*focus.select("text").text(function(columnName){
         //because you didn't explictly set any data on the <text>
         //elements, each one inherits the data from the focus <g>
         return (d[columnName].slice(0,4));
      });*/

      focus_1.select("text").text(function(columnName_1){
          //console.log(d);
         //because you didn't explictly set any data on the <text>
         //elements, each one inherits the data from the focus <g>
         return (d1[columnName_1]);
      });

  }; 

});

  //for brusher of the slider bar at the bottom
  function brushed() {

    xScale.domain(brush.empty() ? xScale2.domain() : brush.extent()); // If brush is empty then reset the Xscale domain to default, if not then make it the brush extent 

    svg.select(".x.axis") // replot xAxis with transition when brush used
          .transition()
          .call(xAxis);

    maxY = findMaxY(categories); // Find max Y rating value categories data with "visible"; true
    yScale.domain([0,maxY]); // Redefine yAxis domain based on highest y value of categories data with "visible"; true
    
    svg.select(".y.axis") // Redraw yAxis
      .transition()
      .call(yAxis);   

    issue.select("path") // Redraw lines based on brush xAxis scale and domain
      .transition()
      .attr("d", function(d){
          return d.visible ? line(d.values) : null; // If d.visible is true then draw line for this d selection
      });

    issue.selectAll(".point")
      .style("fill", function(d) {
        if (d.visible)
          {
            if (d.impevent =="Y") 
              {return "red";} 
            // else { return color(d.category);}
            else { return "none";}
          }
          else
          {
              return "none";
          }
      })
      .style("stroke", function(d) {
        if (d.visible)
          {
            if (d.impevent =="Y") 
              {return "red";} 
            // else { return color(d.category);}
            else { return "none";}
          }
          else
          {
              return "none";
          }
      })
      .transition()
      .attr("cx", function (d,i) {  return xScale(d.date); })
      .attr("cy", function (d) { return !isNaN(d.rating) ? yScale(d.rating): yScale(0); })
      .attr("r", "3px");

  };      

}); // End Data callback function
  
  function findMaxY(data){  // Define function "findMaxY"
    var maxYValues = data.map(function(d) { 
      if (d.visible){
        return d3.max(d.values, function(value) { // Return max rating value
          return value.rating; })
      }
    });
    return d3.max(maxYValues);
  }

</script>
<!--end of Melissa's Code-->
<!-- mayank's code -->
<style>

svg.parallel {
  font: 10px sans-serif;
}

.parallel .background path {
  fill: none;
  stroke: none;
  stroke-width: 20px;
  pointer-events: stroke;
}

.foreground path {
  fill: none;
  stroke: black;
  stroke-width: 0.25px;
}

.axis .title {
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
}

.axis line,
.axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

.label {
  -webkit-transition: fill 125ms linear;
  font-weight:bold;
}

.active .label:not(.inactive) {
  fill:#000;
  font-weight:bold;
}

.label.inactive {
  fill: #000;
  font-weight:bold;
}

.foreground path.inactive {
  stroke: #555;
  stroke-opacity: .75;
  stroke-width: 0.10px;
}

.foreground path.highlight {
  stroke: #E45E2D;
  stroke-opacity: 1.0;
  stroke-width: 2px;
}

.foreground .phase1{
 stroke: #BEE0CC;
}
.foreground .phase2{
 stroke: #70C3D0;
}
.foreground .phase3{
 stroke: #419DC5;
}
.foreground .phase4{
 stroke: #316BA7;
}
.foreground .phase5{
 stroke: #223B89;
}
.foreground .phase6{
 stroke: #151E5E;
}
.p1{
 fill: #BEE0CC;
}
.p2{
 fill: #70C3D0;
}
.p3{
 fill: #419DC5;
}
.p4{
 fill: #316BA7;
}
.p5{
 fill: #223B89;
}
.p6{
 fill: #151E5E;
}
</style>
<script>
var margin_parallel = {top: 30, right: 100, bottom: 20, left: 150},
    width_parallel = 600 - margin_parallel.left - margin_parallel.right,
    height_parallel = 540 - margin_parallel.top - margin_parallel.bottom;

var dimensions = [
  {
    name: "Date",
    scale: d3.scale.ordinal().rangePoints([0,height]),
    type: String
  },
  {
    name: "log(Retweets)",
    scale: d3.scale.linear().range([height, 0]),
    type: Number
  },
  {
    name: "log(Favorites)",
    scale: d3.scale.linear().range([height, 0]),
    type: Number
  },
  {
    name: "Message Type",
    scale: d3.scale.ordinal().rangePoints([0, height]),
    type: String
  }
];

var x = d3.scale.ordinal()
    .domain(dimensions.map(function(d) { return d.name; }))
    .rangePoints([0, width_parallel]);

var line_parallel = d3.svg.line()
    .defined(function(d) { return !isNaN(d[1]); });

var yAxis = d3.svg.axis().orient("left");
var month_axis=d3.svg.axis().orient("left");
var yAxis_right = d3.svg.axis().orient("right");

var svg_parallel = d3.select(".story_viz").append("svg").attr("class","parallel").attr("style","float:left; margin-left:-380px; margin-top:-50px;")
    .attr("width", width_parallel + margin_parallel.left + margin_parallel.right)
    .attr("height", height_parallel + margin_parallel.top + margin_parallel.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	
var projection;
	
var dimension = svg_parallel.selectAll(".dimension")
    .data(dimensions)
  .enter().append("g")
    .attr("class", "dimension")
    .attr("transform", function(d) { return "translate(" + x(d.name) + ")"; });
var dateScale;
var monthScale;

var theme_section=svg_parallel.append("g").attr("class","themes").attr("transform","translate(0,420)");
var theme_title=
	theme_section.append("g").attr("class","title").append("text").attr("style","font-size:12px");
var theme_desc=	svg_parallel.append("g").attr("class","desc").attr("transform","translate(0,440)").append("text").attr("style","font-size:12px");

d3.json("tweets.json", function(error, data) {
  if (error) throw error;
  data.reverse();
	
  dimensions.forEach(function(dimension) {
	  
	  if(dimension.name === "Date"){
		monthScale=dimension.scale.domain(data.map(function(d) { return d[dimension.name]; }));
	  }else if (dimension.type === Number){
		  dimension.scale.domain(d3.extent(data, function(d) { return +d[dimension.name]; }));
	  }else{
		  dimension.scale.domain(data.map(function(d) { return d[dimension.name]; }).sort());
	  }
  });

  svg_parallel.append("g")
      .attr("class", "background")
    .selectAll("path")
      .data(data)
    .enter().append("path")
      .attr("d", draw);

  svg_parallel.append("g")
      .attr("class", "foreground")
    .selectAll("path")
      .data(data)
    .enter().append("path").attr("class",function(d){ return "phase"+d.phase})
      .attr("d", draw);

  dimension.append("g")
      .attr("class", "axis")
      .each(function(d) { 
	    d3.select(this).call(yAxis.scale(d.scale)); 
	    if(d.name==="Message Type"){  d3.select(this).call(yAxis_right.scale(d.scale)); } 
		else if(d.name==="Date"){  d3.select(this).call(month_axis.scale(d.scale).tickValues(d.scale.domain().filter(function(d,i){ return !(i%12); }))); }								   
  	  })
      .append("text")
      .attr("class", "title")
      .attr("text-anchor", "middle")
      .attr("y", -9)
      .text(function(d) { return d.name; });

  // Rebind the axis data to simplify mouseover.
  svg_parallel.select(".axis").selectAll("text:not(.title)")
      .attr("class", "label")
      .data(data, function(d) { return d.name || d; });

  projection = svg_parallel.selectAll(".axis text,.background path,.foreground path")
      .on("mouseover", mouseover)
      .on("mouseout", mouseout);

  function mouseover(d) {
	var highlight_phase=d.phase;
    svg_parallel.classed("active", true);
    projection.classed("inactive", function(p) { return p.phase !== d.phase; });
	projection.classed("highlight", function(p) { return p == d; });
    projection.filter(function(p) { return p.phase === d.phase; }).each(moveToFront);
	projection.filter(function(p) { return p === d; }).each(moveToFront);
	if(highlight_phase){
	d3.json("phases.json", function(error, data) {
	theme_title.text("Top themes across Phase "+highlight_phase+" (Tweet Frequency)");
	var text="";
	theme_desc.selectAll("tspan").remove();
	for(i=0; i<data["Phase"+highlight_phase].length; i++){
		theme_desc.append("tspan").attr("x","0").attr("y",i*15).attr("class","p"+highlight_phase).text(data["Phase"+highlight_phase][i]);
	}
});
  }
  }

  function mouseout(d) {
    svg_parallel.classed("active", false);
    projection.classed("inactive", false);
	projection.classed("highlight", false);
	overall();
  }

  function moveToFront() {
    this.parentNode.appendChild(this);
  }
});
	
function overall(){
d3.json("phases.json", function(error, data) {
	theme_title.text("Top themes across Phases (Tweet Frequency)");
	theme_desc.selectAll("tspan").remove();
	var text="";
	for(i=0; i<data["Overall"].length; i++){
		theme_desc.append("tspan").attr("font-weight","bold").attr("x","0").attr("y",i*15).text(data["Overall"][i]);
	}
});
}
overall();

function draw(d) {
  return line_parallel(dimensions.map(function(dimension) {
    return [x(dimension.name), dimension.scale(d[dimension.name])];
  }));
}
	
var special_mouseover= function(id) {
	var highlight_phase;
	svg_parallel.select(".foreground").selectAll("path").each(function(d){
		if(d.Tweet_ID == id){
			highlight_phase=d.phase;
		}
	});
    svg_parallel.classed("active", true);
    projection.classed("inactive", function(p) { return p.phase !== highlight_phase; });
	projection.classed("highlight", function(p) { return p.Tweet_ID == id; });
    projection.filter(function(p) { return p.phase === highlight_phase; }).each(moveToFront);
	projection.filter(function(p) { return p.Tweet_ID == id; }).each(moveToFront);
	
	d3.json("phases.json", function(error, data) {
	theme_title.text("Top themes across Phase "+highlight_phase+" (Tweet Frequency)");
	var text="";
	theme_desc.selectAll("tspan").remove();
	for(i=0; i<data["Phase"+highlight_phase].length; i++){
		theme_desc.append("tspan").attr("x","0").attr("y",i*15).attr("class","p"+highlight_phase).text(data["Phase"+highlight_phase][i]);
	}
});
  }
function moveToFront() {
    this.parentNode.appendChild(this);
  }

</script>
</head>
</html>
